
@model IEnumerable<OPDCLAIMFORM.OPDEXPENSE_PATIENT>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
</head>
<body>
    <table id="tblCustomers" class="table" cellpadding="0" cellspacing="0">
        <tr>
            <th style="width:100px">Id</th>
            <th style="width:150px">Name</th>
            <th style="width:150px">Age</th>
            <th style="width:150px">RelationShip</th>
            <th style="width:150px"></th>
        </tr>
        @foreach (OPDEXPENSE_PATIENT customer in Model)
        {
            <tr>
                <td class="ID">
                    <span>@customer.ID</span>
                </td>
                <td class="NAME">
                    <span>@customer.NAME</span>
                    <input type="text" value="@customer.NAME" style="display:none" />
                </td>
                <td class="AGE">
                    <span>@customer.AGE</span>
                    <input type="text" value="@customer.AGE" style="display:none" />
                </td>
                <td class="RELATIONSHIP_EMPLOYEE">
                    <span>@customer.RELATIONSHIP_EMPLOYEE</span>
                    <select id="relationShipListForEdit" style="display:none">
                        <option value="SELF">SELF</option>
                        <option value="FATHER">FATHER</option>
                        <option value="MOTHER">MOTHER</option>
                        <option value="SPOUSE">SPOUSE</option>
                        <option value="DAUGHTER">DAUGHTER</option>
                        <option value="SON">SON</option>
                    </select>
                </td>
                <td>                    
                    <a class="Update" href="javascript:;" style="display:none">Update</a>
                    <a class="Cancel" href="javascript:;" style="display:none">Cancel</a>
                    <a class="Delete" href="javascript:;">Delete</a>
                </td>
            </tr>
        }
    </table>
    <table border="0" cellpadding="0" cellspacing="0">
        <tr>
            <td style="width: 150px">
                Name of Patient:<br />
                <input type="text" id="txtNAME" style="width:140px" required  />
            </td>
            <td style="width: 150px">
                Age of Person:<br />
                <input type="number" id="txtAGE" style="width:140px" required />
            </td>
            <td style="width : 150px">
                Relationship:<br />
                <select id="relationShipList" style="width:140px">
                    <option value="SELF">SELF</option>
                    <option value="FATHER">FATHER</option>
                    <option value="MOTHER">MOTHER</option>
                    <option value="SPOUSE">SPOUSE</option>
                    <option value="DAUGHTER">DAUGHTER</option>
                    <option value="SON">SON</option>
                </select>

            </td>
            <td style="width: 200px">
                <br />
                <input type="submit" id="btnAdd" value="Add"  />
            </td>
        </tr>
    </table>
  
    <p>
        <div>
            @Html.ActionLink("Back to List", "Index","OPDEXPENSEs")
        </div>
        <div>
            @Html.ActionLink("Add Image", "Index", "OPDEXPENSEIMAGE", new { id = @ViewData["OPDEXPENSE_ID"] }, null)
        </div>
       
    </p>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    <script type="text/javascript">
        $(function () {
            //Remove the dummy row if data present.
            if ($("#tblCustomers tr").length > 2) {
                $("#tblCustomers tr:eq(1)").remove();
            } else {
                var row = $("#tblCustomers tr:last-child");
                row.find(".Edit").hide();
                row.find(".Delete").hide();
                row.find("span").html('&nbsp;');
            }
        });

        function AppendRow(row, ID, NAME, AGE, RELATIONSHIP_EMPLOYEE) {
            //Bind CustomerId.
            $(".ID", row).find("span").html(ID);

            //Bind Name.
            $(".NAME", row).find("span").html(NAME);
            $(".NAME", row).find("input").val(NAME);

            //Bind AGE.
            $(".AGE", row).find("span").html(AGE);
            $(".AGE", row).find("input").val(AGE);

            $(".RELATIONSHIP_EMPLOYEE", row).find("span").html(RELATIONSHIP_EMPLOYEE);

            //$("#relationShipListForEdit option:contains(" + RELATIONSHIP_EMPLOYEE + ")").attr("selected", "selected");

            $('#relationShipListForEdit').val(RELATIONSHIP_EMPLOYEE).change();


            row.find(".Edit").show();
            row.find(".Delete").show();
            $("#tblCustomers").append(row);
        };

        //Add event handler.
        $("body").on("click", "#btnAdd", function () {

            const isValidName = txtNAME.checkValidity();
            const isValidAge = txtAGE.checkValidity();

            if (isValidName && isValidAge) {
                var txtName = $("#txtNAME");
                var txtAge = $("#txtAGE");
                var ddlRelationship_Employee = $("#relationShipList option:selected").text();
                var txtOPDExpense = "@ViewData["OPDEXPENSE_ID"]";
                $.ajax({
                    type: "POST",
                    url: "/OPDEXPENSEPATIENT/InsertOPDExpensePatient",
                    data: '{NAME: "' + txtName.val() + '", AGE: "' + txtAge.val() + '", RELATIONSHIP_EMPLOYEE: "' + ddlRelationship_Employee + '", OPDEXPENSE_ID: "' + txtOPDExpense + '"}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (r) {
                        var row = $("#tblCustomers tr:last-child");
                        if ($("#tblCustomers tr:last-child span").eq(0).html() != "&nbsp;") {
                            row = row.clone();
                        }
                        AppendRow(row, r.ID, r.NAME, r.AGE, r.RELATIONSHIP_EMPLOYEE);
                        txtName.val("");
                        txtAge.val("");
                        //$('#relationShipListForEdit').val("SELF").change();

                        $('select[name^="relationShipList"] option:selected').attr("selected", null);

                        $("#relationShipList option[value='SELF']").attr("selected", "selected");
                        //$("#relationShipList option:contains(SELF)").attr("selected", "selected");
                    }
                });
            } else {

                validationMessage();               
            }

        });

        //Edit event handler.
        $("body").on("click", "#tblCustomers .Edit", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {

                $(this).find("input").show();

                $(this).find("span").hide();

                if ($(this).find("select").length > 0) {

                    var selectedText = $(this).find("span").text();

                    $("#relationShipListForEdit option:contains(" + selectedText + ")").attr("selected", "selected");

                    $(this).find("select").show();
                }

            });
            row.find(".Update").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Update event handler.
        $("body").on("click", "#tblCustomers .Update", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                //if ($(this).find("input").length > 0) {
                var span = $(this).find("span");
                var input = $(this).find("input");
                var select = $(this).find("select")
                if ($(this).find("select").length > 0) {
                    var select = $(this).find("select")
                    span.html($("select option:selected").html());
                    select.hide();
                }
                span.html(input.val());
                span.show();
                input.hide();

                // }
            });
            row.find(".Edit").show();
            row.find(".Delete").show();
            row.find(".Cancel").hide();
            $(this).hide();

            var opdExpense_Patient = {};
            opdExpense_Patient.ID = row.find(".ID").find("span").html();
            opdExpense_Patient.NAME = row.find(".NAME").find("span").html();
            opdExpense_Patient.AGE = row.find(".AGE").find("span").html();
            opdExpense_Patient.RELATIONSHIP_EMPLOYEE = row.find(".RELATIONSHIP_EMPLOYEE").find("span").html();
            $.ajax({
                type: "POST",
                url: "/OPDEXPENSEPATIENT/UpdateOPDExpensePatient",
                data: '{OPDEXPENSE_PATIENT:' + JSON.stringify(opdExpense_Patient) + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json"
            });
        });

        //Cancel event handler.
        $("body").on("click", "#tblCustomers .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Edit").show();
            row.find(".Delete").show();
            row.find(".Update").hide();
            $(this).hide();
        });

        //Delete event handler.
        $("body").on("click", "#tblCustomers .Delete", function () {
            if (confirm("Do you want to delete this row?")) {
                var row = $(this).closest("tr");
                var ID = row.find("span").html();
                $.ajax({
                    type: "POST",
                    url: "/OPDEXPENSEPATIENT/DeleteOPDExpensePatient",
                    data: '{ID: ' + ID + '}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    error: function () {
                        if ($("#tblCustomers tr").length > 2) {
                            row.remove();
                        } else {
                            row.find(".Edit").hide();
                            row.find(".Delete").hide();
                            row.find("span").html('&nbsp;');
                        }
                    }
                });
            }
        });

        function validationMessage() {
             var focusSet = false;
                if (!$('#txtNAME').val()) {
                    if ($("#txtNAME").parent().next(".validation").length == 0) // only add if not added
                    {
                        $("#txtNAME").parent().after("<div class='validation' style='color:red;margin-bottom: 20px;'>Please enter name</div>");
                    }
                    //e.preventDefault(); // prevent form from POST to server
                    $('#txtNAME').focus();
                    focusSet = true;
                } else {
                    $("#txtNAME").parent().next(".validation").remove(); // remove it
                }
                if (!$('#txtAGE').val()) {
                    if ($("#txtAGE").parent().next(".validation").length == 0) // only add if not added
                    {
                        $("#txtAGE").parent().after("<div class='validation' style='color:red;margin-bottom: 20px;'>Please enter age</div>");
                    }
                    //e.preventDefault(); // prevent form from POST to server
                    if (!focusSet) {
                        $("#txtAGE").focus();
                    }
                } else {
                    $("#txtAGE").parent().next(".validation").remove(); // remove it
                }
        }




    </script>
</body>
</html>




@*<a class="Edit" href="javascript:;">Edit</a>*@
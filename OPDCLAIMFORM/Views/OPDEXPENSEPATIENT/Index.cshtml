
@model IEnumerable<OPDCLAIMFORM.OPDEXPENSE_PATIENT>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <style>
        .mytable td{
        padding-bottom : 15px;
        }

    </style>
</head>
<body>
    <br />
    <div class="row">
        <div class="col-md-6 col-md-push-2">
            <section>
                <table class="mytable" border="0" cellpadding="0" cellspacing="0" style="margin-top:30px">
                    <tr>
                        <td class="control-label col-md-2">
                            <span>Name:</span>
                        </td>
                        <td>
                            <input type="text" id="txtNAME" class="form-control" required />
                        </td>

                    </tr>

                    <tr>
                        <td class="control-label col-md-2">
                            <span>Age:</span>
                        </td>
                        <td>
                            <input type="number" id="txtAGE" class="form-control" required />
                        </td>

                    </tr>
                    <tr>
                        <td class="control-label col-md-2">
                            Relationship:
                        </td>
                        <td>
                            <select id="relationShipList" class="form-control">
                                <option value="SELF">SELF</option>
                                <option value="FATHER">FATHER</option>
                                <option value="MOTHER">MOTHER</option>
                                <option value="SPOUSE">SPOUSE</option>
                                <option value="DAUGHTER">DAUGHTER</option>
                                <option value="SON">SON</option>
                            </select>
                        </td>

                    </tr>
                    <tr align="right">
                        <td colspan="3">
                            <br />
                            <input type="submit" id="btnAdd" value="Add" class="btn btn-primary" />
                        </td>
                    </tr>
                </table>
            </section>
        </div>
    </div>
    <hr />

    <div class="row">
        <div class="col-md-offset-4 col-md-8">
            <h3>List of Patients </h3>
        </div>
    </div>

    <hr />



    <table id="tblCustomers" class="table" cellpadding="0" cellspacing="0">
        <tr>
            <th style="width:100px">Id</th>
            <th style="width:150px">Name</th>
            <th style="width:150px">Age</th>
            <th style="width:150px">RelationShip</th>
            <th style="width:150px"></th>
        </tr>     


            @foreach (OPDEXPENSE_PATIENT customer in Model)
            {
                <tr>
                    <td class="ID">
                        <span>@customer.ID</span>
                    </td>
                    <td class="NAME">
                        <span>@customer.NAME</span>
                        <input type="text" value="@customer.NAME" style="display:none" />
                    </td>
                    <td class="AGE">
                        <span>@customer.AGE</span>
                        <input type="text" value="@customer.AGE" style="display:none" />
                    </td>
                    <td class="RELATIONSHIP_EMPLOYEE">
                        <span>@customer.RELATIONSHIP_EMPLOYEE</span>
                        <select id="relationShipListForEdit" style="display:none">
                            <option value="SELF">SELF</option>
                            <option value="FATHER">FATHER</option>
                            <option value="MOTHER">MOTHER</option>
                            <option value="SPOUSE">SPOUSE</option>
                            <option value="DAUGHTER">DAUGHTER</option>
                            <option value="SON">SON</option>
                        </select>
                    </td>
                    <td>
                        <a class="Update" href="javascript:;" style="display:none">Update</a>
                        <a class="Cancel" href="javascript:;" style="display:none">Cancel</a>
                        <a class="Delete" href="javascript:;">Delete</a>
                    </td>
                </tr>
            }
        </table>

    <p>
        <div>
            @Html.ActionLink("Back to List", "Index", "OPDEXPENSEs") <span>|</span> @Html.ActionLink("Add Image", "Index", "OPDEXPENSEIMAGE", new { id = @ViewData["OPDEXPENSE_ID"] }, null)
        </div>

    </p>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    <script type="text/javascript">
        $(function () {
            //Remove the dummy row if data present.
            if ($("#tblCustomers tr").length > 2) {
                $("#tblCustomers tr:eq(1)").remove();
            } else {
                var row = $("#tblCustomers tr:last-child");
                row.find(".Edit").hide();
                row.find(".Delete").hide();
                row.find("span").html('&nbsp;');
            }
        });

        function AppendRow(row, ID, NAME, AGE, RELATIONSHIP_EMPLOYEE) {
            //Bind CustomerId.
            $(".ID", row).find("span").html(ID);

            //Bind Name.
            $(".NAME", row).find("span").html(NAME);
            $(".NAME", row).find("input").val(NAME);

            //Bind AGE.
            $(".AGE", row).find("span").html(AGE);
            $(".AGE", row).find("input").val(AGE);

            $(".RELATIONSHIP_EMPLOYEE", row).find("span").html(RELATIONSHIP_EMPLOYEE);

            //$("#relationShipListForEdit option:contains(" + RELATIONSHIP_EMPLOYEE + ")").attr("selected", "selected");

            $('#relationShipListForEdit').val(RELATIONSHIP_EMPLOYEE).change();


            row.find(".Edit").show();
            row.find(".Delete").show();
            $("#tblCustomers").append(row);
        };

        //Add event handler.
        $("body").on("click", "#btnAdd", function () {

            const isValidName = txtNAME.checkValidity();
            const isValidAge = txtAGE.checkValidity();

            if (isValidName && isValidAge) {
                var txtName = $("#txtNAME");
                var txtAge = $("#txtAGE");
                var ddlRelationship_Employee = $("#relationShipList option:selected").text();
                var txtOPDExpense = "@ViewData["OPDEXPENSE_ID"]";
                $.ajax({
                    type: "POST",
                    url: "/OPDEXPENSEPATIENT/InsertOPDExpensePatient",
                    data: '{NAME: "' + txtName.val() + '", AGE: "' + txtAge.val() + '", RELATIONSHIP_EMPLOYEE: "' + ddlRelationship_Employee + '", OPDEXPENSE_ID: "' + txtOPDExpense + '"}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (r) {
                        var row = $("#tblCustomers tr:last-child");
                        if ($("#tblCustomers tr:last-child span").eq(0).html() != "&nbsp;") {
                            row = row.clone();
                        }
                        AppendRow(row, r.ID, r.NAME, r.AGE, r.RELATIONSHIP_EMPLOYEE);
                        txtName.val("");
                        txtAge.val("");
                        $('#relationShipList').val("SELF").change();
                        $("#txtNAME").parent().next(".validation").remove();
                        $("#txtAGE").parent().next(".validation").remove();
                    }
                });
            } else {

                validationMessage();
            }

        });


        //Delete event handler.
        $("body").on("click", "#tblCustomers .Delete", function () {
            if (confirm("Do you want to delete this row?")) {
                var row = $(this).closest("tr");
                var ID = row.find("span").html();
                $.ajax({
                    type: "POST",
                    url: "/OPDEXPENSEPATIENT/DeleteOPDExpensePatient",
                    data: '{ID: ' + ID + '}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    error: function () {
                        if ($("#tblCustomers tr").length > 2) {
                            row.remove();
                        } else {
                            row.find(".Edit").hide();
                            row.find(".Delete").hide();
                            row.find("span").html('&nbsp;');
                        }
                    }
                });
            }
        });

        function validationMessage() {
             var focusSet = false;
                if (!$('#txtNAME').val()) {
                    if ($("#txtNAME").parent().next(".validation").length == 0) // only add if not added
                    {
                        $("#txtNAME").parent().after("<div class='validation' style='color:red;text-align: center;'>Please Enter Name</div>");
                    }
                    //e.preventDefault(); // prevent form from POST to server
                    $('#txtNAME').focus();
                    focusSet = true;
                } else {
                    $("#txtNAME").parent().next(".validation").remove(); // remove it
                }
                if (!$('#txtAGE').val()) {
                    if ($("#txtAGE").parent().next(".validation").length == 0) // only add if not added
                    {
                        $("#txtAGE").parent().after("<div class='validation' style='color:red;text-align: center;'>Please Enter Age</div>");
                    }
                    //e.preventDefault(); // prevent form from POST to server
                    if (!focusSet) {
                        $("#txtAGE").focus();
                    }
                } else {
                    $("#txtAGE").parent().next(".validation").remove(); // remove it
                }
        }




    </script>
</body>
</html>




@*<a class="Edit" href="javascript:;">Edit</a>*@